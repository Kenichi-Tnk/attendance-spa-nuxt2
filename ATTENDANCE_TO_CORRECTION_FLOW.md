# 勤怠一覧から修正申請への遷移機能 - テストシナリオ

## 📋 実装内容

### ✅ 追加機能

1. **勤怠一覧画面の改善**

   - 「修正申請」ボタンのデザイン改善（アイコン付き、黄色背景）
   - ボタンクリック時に日付パラメータを渡して修正申請画面へ遷移

2. **修正申請画面の改善**

   - クエリパラメータで日付を受け取る
   - 日付が自動入力される
   - 日付フィールドが読み取り専用になる
   - 自動的に勤怠データをロード
   - パンくずリストが動的に変化（勤怠一覧 or 修正申請）
   - 戻るボタンのリンク先が動的に変化

3. **UX 向上**
   - ユーザーが日付を再度選択する必要がない
   - どこから遷移してきたか明確
   - スムーズな操作フロー

## 🧪 テストケース

### ケース 1: 勤怠一覧から修正申請（正常フロー）

**手順:**

1. `/attendance` にアクセス
2. 勤怠記録の一覧を確認
3. 任意の記録の「修正申請」ボタンをクリック

**期待される動作:**

- ✅ `/correction-requests/new?date=YYYY-MM-DD` に遷移
- ✅ 対象日フィールドに自動的に日付が入力されている
- ✅ 対象日フィールドが読み取り専用（グレー背景）
- ✅ フィールド下に「勤怠一覧から選択された日付です」と表示
- ✅ 現在の勤怠データが自動的に表示される
- ✅ フォームに出勤・退勤時刻が自動入力される
- ✅ パンくずリスト: `ダッシュボード > 勤怠一覧 > 新規申請`
- ✅ 戻るボタンのテキスト: 「勤怠一覧へ戻る」

**コンソールログ確認:**

```
日付パラメータを受信: 2024-11-15
日付変更: → 2024-11-15
取得した修正申請データ: [...]
申請中のリクエスト: null (or {...})
```

### ケース 2: 勤怠一覧から修正申請（承認待ちあり）

**手順:**

1. `/attendance` にアクセス
2. 既に承認待ちの申請がある日付の「修正申請」ボタンをクリック

**期待される動作:**

- ✅ 修正申請画面に遷移
- ✅ 日付が自動入力
- ✅ 黄色い承認待ちアラートが表示される
- ✅ フォームの入力フィールドが全てクリア＆無効化
- ✅ 「申請する」ボタンが非表示
- ✅ 「申請内容を確認」ボタンで詳細ページへ遷移可能

### ケース 3: 直接 URL で修正申請画面にアクセス（日付パラメータあり）

**手順:**

1. `/correction-requests/new?date=2024-11-15` に直接アクセス

**期待される動作:**

- ✅ ケース 1 と同じ動作
- ✅ 日付が自動入力され、データがロードされる

### ケース 4: 修正申請一覧から新規申請（従来の方法）

**手順:**

1. `/correction-requests` にアクセス
2. 「新規申請作成」ボタンをクリック

**期待される動作:**

- ✅ `/correction-requests/new` に遷移（日付パラメータなし）
- ✅ 対象日フィールドは空欄
- ✅ 対象日フィールドは入力可能（白背景）
- ✅ ヘルプテキストは表示されない
- ✅ パンくずリスト: `ダッシュボード > 修正申請 > 新規申請`
- ✅ 戻るボタンのテキスト: 「キャンセル」
- ✅ ユーザーが手動で日付を選択可能

### ケース 5: 修正申請後の戻る操作

**手順:**

1. 勤怠一覧から修正申請画面へ遷移
2. 「勤怠一覧へ戻る」ボタンをクリック

**期待される動作:**

- ✅ `/attendance` に戻る
- ✅ 以前表示していた勤怠一覧が表示される

**手順（従来の方法）:**

1. 修正申請一覧から新規申請画面へ遷移
2. 「キャンセル」ボタンをクリック

**期待される動作:**

- ✅ `/correction-requests` に戻る
- ✅ 修正申請一覧が表示される

### ケース 6: 勤怠一覧のボタン表示制御

**確認項目:**

- ✅ 出勤打刻がある記録には「修正申請」ボタンが表示される
- ✅ 承認待ちステータス（status: pending）の記録には「修正申請」ボタンが表示されない
- ✅ 「詳細」ボタンは常に表示される
- ✅ ボタンにアイコンが表示される（詳細: 目アイコン、修正申請: 編集アイコン）

### ケース 7: UI/UX の確認

**視覚的確認:**

- ✅ 「詳細」ボタン: 青色背景、青色テキスト
- ✅ 「修正申請」ボタン: 黄色背景、オレンジ色テキスト
- ✅ ボタンホバー時に色が濃くなる
- ✅ アイコンとテキストの間隔が適切
- ✅ ボタンサイズが統一されている

**日付フィールドの見た目:**

- ✅ 読み取り専用時: 薄いグレー背景
- ✅ 読み取り専用時: フォーカス時にボーダー色が変わらない
- ✅ 通常時: 白背景、フォーカス時に青いボーダー

## 🎯 期待される操作フロー図

```
【パターンA: 勤怠一覧経由】
┌────────────────┐
│  勤怠一覧      │
│                │
│  [修正申請] ← クリック
└────────────────┘
         ↓
┌────────────────────────────┐
│ 修正申請画面               │
│ ・日付自動入力（読取専用） │
│ ・データ自動ロード         │
│ ・[勤怠一覧へ戻る]         │
└────────────────────────────┘
         ↓ 申請送信
┌────────────────┐
│ 修正申請一覧   │
└────────────────┘


【パターンB: 修正申請一覧経由】
┌────────────────┐
│ 修正申請一覧   │
│                │
│ [新規申請作成] ← クリック
└────────────────┘
         ↓
┌────────────────────────────┐
│ 修正申請画面               │
│ ・日付未入力（入力可能）   │
│ ・手動で日付選択           │
│ ・[キャンセル]             │
└────────────────────────────┘
         ↓ 申請送信
┌────────────────┐
│ 修正申請一覧   │
└────────────────┘
```

## 📊 変更ファイル一覧

### 修正されたファイル

1. **`pages/attendance/index.vue`**

   - `requestCorrection()`メソッド: 日付をクエリパラメータで渡す
   - アクションボタンにアイコン追加

2. **`pages/correction-requests/new.vue`**

   - `mounted()`: クエリパラメータから日付を受け取る
   - `data()`: `isDateFromQuery`フラグ追加
   - `computed.breadcrumbs()`: 動的なパンくずリスト
   - 日付フィールド: 読み取り専用対応
   - ヘルプテキスト追加
   - 戻るボタン: 動的なリンク先とテキスト

3. **`assets/css/pages/attendance-index.css`**

   - アクションボタンのスタイル改善
   - ホバーエフェクト追加

4. **`assets/css/pages/correction-requests-new.css`**
   - 読み取り専用フィールドのスタイル
   - ヘルプテキストのスタイル

## 🐛 デバッグポイント

### コンソールログで確認すべき内容

```javascript
// 勤怠一覧での修正申請ボタンクリック時
Record not found: xxx // このエラーが出たらrecordが見つかっていない

// 修正申請画面での受信確認
日付パラメータを受信: YYYY-MM-DD
日付変更: → YYYY-MM-DD
取得した修正申請データ: [...]
申請中のリクエスト: {...} or null
```

### よくある問題と解決方法

**問題 1: 日付が自動入力されない**

- クエリパラメータが正しく渡されているか確認
- コンソールに「日付パラメータを受信」が表示されているか確認
- `this.$route.query.date`の値を確認

**問題 2: 勤怠データが表示されない**

- `loadAttendanceData()`が実行されているか確認
- API レスポンスが正常か確認
- 日付フォーマットが一致しているか確認（YYYY-MM-DD）

**問題 3: 戻るボタンの遷移先が間違っている**

- `isDateFromQuery`の値を確認
- パンくずリストが正しく表示されているか確認

**問題 4: ボタンのスタイルが適用されない**

- CSS ファイルが正しく読み込まれているか確認
- ブラウザのキャッシュをクリア
- 開発ツールでクラスが正しく適用されているか確認

## ✨ 今後の改善案

1. **URL の最適化**

   - `/correction-requests/new/2024-11-15` のようなパス形式も検討

2. **承認待ち時の制御強化**

   - 勤怠一覧画面でも承認待ちのレコードを視覚的に区別
   - 承認待ちレコードの「修正申請」ボタンを非表示または無効化

3. **アクセシビリティ改善**

   - キーボード操作対応
   - スクリーンリーダー対応

4. **パフォーマンス最適化**
   - 勤怠データのキャッシュ
   - 不要な API コールの削減

---

この実装により、ユーザーは勤怠一覧から直接修正申請でき、日付を再選択する手間が省けます！
